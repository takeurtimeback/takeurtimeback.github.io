<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TYT - EVENTS</title>

    <link href="../style/style.css" rel="stylesheet" type="text/css" media="all">
</head>
<body class="DoorBackground">
    
    <!-- Back Arrow -->
    <a href="./home.html" class="backArrow"></a> 

    <div class="door-title">
        <h3>(scroll)</h3>
    </div>

    <!-- Events container, populated by script -->
    <ul class="events-container">
    </ul>

    <!-- Background Image -->
    <img src="../imgs/DoorBackground.png" class="background-image" alt="Background Image">
    
    <!-- link to games/ immersive sim-->
    <a href="./TYTBeyond/beyond.html">
        <img src="../imgs/tytimmersivesim/arrow.png" style=" width: 5%; height: 3%; rotate:90deg; position: absolute; right: 2%; top: 42%; z-index: 1;" alt="Arrow">
    </a>
    
    <!-- load posters-->
    <script>
        const listEL = document.querySelector('ul');
        //retrieve posters from localStorage
        const jDat = JSON.parse(localStorage.getItem('jDat')) || [];
        console.log(jDat);

        //loop through events and only use those that have displayweb set to true
        jDat.data.forEach(event => {
            // Parse event date (MM-DD)
            const [eventMonth, eventDay] = event.Date.split('-').map(Number);

            // Get today's month and day
            const today = new Date();
            const todayMonth = today.getMonth() + 1; // getMonth() is zero-based
            const todayDay = today.getDate();

            // Only show events today or later
            const isFutureOrToday =
                eventMonth > todayMonth ||
                (eventMonth === todayMonth && eventDay >= todayDay);

            if (
                event.NoDisplayWeb == false &&
                event.PosterLink.substring(0, 1) == "h" &&
                isFutureOrToday
            ) {
                //process each poster link
                const sheetUrl = event.PosterLink || "";
                const match = sheetUrl.match(/\/d\/([^/]+)/);
                const posterID = match ? match[1] : null;
                const posterURL = posterID ? `https://drive.google.com/thumbnail?id=${posterID}` : null;
                const TicketLink = event.TicketLink || "";
                console.log(TicketLink)

                let liHTML = `<li class="event-item flex column">`;

                 //add each poster as a rot class and have them linked to their respective TicketLinks links        
                if (posterURL) {
                    if("${TicketLink}" != "") {
                    liHTML += ` <a target="_blank" href="${TicketLink}" class="rotate2" >
                    <img class="poster-image" src="${posterURL}" alt="Poster for ${event.Artists}">
                </a>`;

            }else{
                liHTML += ` <a class="rotate2" >
                    <img class="poster-image" src="${posterURL}" alt="Poster for ${event.Artists}">
                </a>`;
            }

                }
                //
                liHTML += `
                    <div class="event-details">
                        <div class="event-time">
                           ${event.Day}
                            ${event.Date} 
                           <hr class="event-hr">
                        </div>
                        <div class="event-artists" padding: 0.5em 1em; border-radius: 0.5em;"> 
                           ${event.Artists.replace(/,/g, '<br>')}
                        </div>
                    </div>
                </li>`;

                listEL.insertAdjacentHTML('beforeend', liHTML);
            }
        });
    </script>

</body>
</html>